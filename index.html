<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Blanco Especial para Claudia</title>
    
   <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üè• Examen Blanco MIR para Claudia</h1>
        <p>M√©dico Interno Residente - Simulacro</p>
    </div>

    <div class="timer" id="timer">‚è±Ô∏è Tiempo: 00:00</div>
    <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>
    <div id="questionsContainer"></div>

    <div class="results" id="results">
        <h2>üéØ Resultados del Examen</h2>
        <div class="score" id="finalScore"></div>
        <div class="score-message" id="scoreMessage"></div>
        <button class="btn btn-primary" onclick="location.reload()">üîÑ Reintentar Examen</button>
    </div>
</div>

<script>
let questionsData = null;
let currentQuestion = 0;
let score = 0;
let unknownCount = 0;
let incorrectCount = 0;
let correctCount = 0;
let userAnswers = [];
let startTime = Date.now();
let timerInterval;

async function loadQuestions() {
    try {
        const response = await fetch('questions.json');
        if (!response.ok) throw new Error('No se pudo cargar el archivo questions.json');
        questionsData = await response.json();
        startTimer();
        renderQuestion(0);
    } catch (error) {
        console.error('Error cargando preguntas:', error);
        document.getElementById('questionsContainer').innerHTML = `<div class="question-card active" style="display: block;">
            <h2 style="color: #ff6b6b;">‚ö†Ô∏è Error</h2>
            <p>No se pudo cargar el archivo <strong>questions.json</strong></p>
            <p>Aseg√∫rate de que el archivo existe en la misma carpeta que index.html</p>
        </div>`;
    }
}

function startTimer() {
    timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('timer').textContent = 
            `‚è±Ô∏è Tiempo: ${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
    }, 1000);
}

function updateProgressBar() {
    const progress = ((currentQuestion+1)/questionsData.questions.length)*100;
    document.getElementById('progressBar').style.width = progress+'%';
}

function renderQuestion(index) {
    const question = questionsData.questions[index];
    const container = document.getElementById('questionsContainer');

    const questionHTML = `
        <div class="question-card active" id="question-${index}">
            <div class="question-number">Pregunta ${index+1} de ${questionsData.questions.length}</div>
            <div class="question-text">${question.pregunta}</div>
            <div class="options">
                ${question.opciones.map((option,i)=>`
                    <div class="option" onclick="selectAnswer(${index},${i})">
                        ${String.fromCharCode(65+i)}. ${option}
                    </div>`).join('')}
                <div class="option option-unknown" onclick="selectUnknown(${index})">
                    ‚ùì No lo s√© / Necesito revisar este tema
                </div>
            </div>
            <div class="explanation" id="explanation-${index}">
                <strong>üí° Explicaci√≥n:</strong><br>${question.explicacion}
            </div>
            <div class="navigation">
                ${index>0?'<button class="btn btn-secondary" onclick="previousQuestion()">‚¨ÖÔ∏è Anterior</button>':''}
                <button class="btn btn-primary" id="checkBtn-${index}" onclick="checkAnswer(${index})" disabled>‚úì Comprobar</button>
                ${index<questionsData.questions.length-1?'<button class="btn btn-success" id="nextBtn-'+index+'" onclick="nextQuestion()" style="display:none">Siguiente ‚û°Ô∏è</button>':'<button class="btn btn-success" id="finishBtn" onclick="finishExam()" style="display:none">üèÅ Finalizar</button>'}
            </div>
        </div>
    `;
    container.innerHTML = questionHTML;
    updateProgressBar();
}

function selectAnswer(questionIndex, optionIndex){
    if(userAnswers[questionIndex]!==undefined) return;
    const options = document.querySelectorAll(`#question-${questionIndex} .option`);
    options.forEach(opt=>opt.classList.remove('selected'));
    options[optionIndex].classList.add('selected');
    userAnswers[questionIndex] = {type:'answer', value:optionIndex};
    document.getElementById(`checkBtn-${questionIndex}`).disabled=false;
}

function selectUnknown(questionIndex){
    if(userAnswers[questionIndex]!==undefined) return;
    const options = document.querySelectorAll(`#question-${questionIndex} .option`);
    options.forEach(opt=>opt.classList.remove('selected'));
    const unknownOption = document.querySelector(`#question-${questionIndex} .option-unknown`);
    unknownOption.classList.add('selected');
    userAnswers[questionIndex] = {type:'unknown'};
    document.getElementById(`checkBtn-${questionIndex}`).disabled=false;
}

function checkAnswer(questionIndex){
    const question = questionsData.questions[questionIndex];
    const options = document.querySelectorAll(`#question-${questionIndex} .option`);
    const userAnswer = userAnswers[questionIndex];

    options.forEach((opt,i)=>{
        opt.classList.add('disabled');
        if(i===question.respuestaCorrecta) opt.classList.add('correct');
    });

    if(userAnswer.type==='unknown'){
        unknownCount++;
        document.querySelector(`#question-${questionIndex} .option-unknown`).style.background='#ffc107';
    } else if(userAnswer.value===question.respuestaCorrecta){
        correctCount++;
        score+=3;
    } else {
        incorrectCount++;
        score-=1;
        options[userAnswer.value].classList.add('incorrect');
    }

    document.getElementById(`explanation-${questionIndex}`).classList.add('show');
    document.getElementById(`checkBtn-${questionIndex}`).style.display='none';
    if(questionIndex<questionsData.questions.length-1){
        document.getElementById(`nextBtn-${questionIndex}`).style.display='block';
    } else {
        document.getElementById('finishBtn').style.display='block';
    }
}

function nextQuestion(){currentQuestion++; renderQuestion(currentQuestion);}
function previousQuestion(){currentQuestion--; renderQuestion(currentQuestion);}

function finishExam(){
    clearInterval(timerInterval);
    document.getElementById('questionsContainer').style.display='none';
    document.querySelector('.timer').style.display='none';
    document.querySelector('.progress-bar').style.display='none';

    const total = questionsData.questions.length;
    const maxScore = total*3;
    const percentage = Math.round((score/maxScore)*100);

    document.getElementById('finalScore').innerHTML = `
        <div style="margin-bottom:20px;">
            <div style="font-size:0.6em;color:#667eea;margin-bottom:15px;">Puntuaci√≥n: ${score} / ${maxScore} puntos</div>
            <div style="font-size:0.5em;color:#51cf66;">‚úì Correctas: ${correctCount} (+${correctCount*3} puntos)</div>
            <div style="font-size:0.5em;color:#ff6b6b;">‚úó Incorrectas: ${incorrectCount} (${incorrectCount*-1} puntos)</div>
            <div style="font-size:0.5em;color:#ffc107;">‚ùì No sab√≠a: ${unknownCount} (0 puntos)</div>
        </div>
    `;

    let message = `<strong>Porcentaje:</strong> ${percentage}%<br><br>`;
    message += `<div style="background:#f8f9fa;padding:15px;border-radius:10px;margin:20px 0;font-size:0.9em;text-align:left;">
        <strong>üìä Sistema de puntuaci√≥n:</strong><br>
        ‚úÖ Respuesta correcta: +3 puntos<br>
        ‚ùå Respuesta incorrecta: -1 punto<br>
        ‚ùì No lo s√©: 0 puntos<br><br>
        <em>¬°Es mejor ser honesta que adivinar!</em>
    </div>`;

    if(score<0) message+='‚ö†Ô∏è Has perdido puntos por adivinar. Recuerda: es mejor marcar "No lo s√©" que responder al azar.';
    else if(unknownCount===0 && percentage>=90) message+='üåü ¬°Excelente! Dominas muy bien el tema y fuiste valiente al intentar todas las preguntas.';
    else if(unknownCount===0 && percentage>=70) message+='üëç ¬°Muy bien! Buen nivel de conocimientos.';
    else if(unknownCount>total*0.5) message+='üìö Buena actitud siendo honesta. Identifica bien tus √°reas de mejora. ¬°Sigue estudiando!';
    else if(percentage>=60) message+='üí™ Buen equilibrio entre conocimiento y honestidad. Sigue as√≠.';
    else message+='üìñ Revisa los temas marcados y evita adivinar en el futuro.';

    document.getElementById('scoreMessage').innerHTML = message;
    document.getElementById('results').classList.add('show');
}

loadQuestions();
</script>
</body>
</html>